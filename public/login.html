<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chek El - Login</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="/public/csses/enhanced-login.css" rel="stylesheet">
</head>
<body>
    <div class="page-wrapper">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <i class="fas fa-sparkles me-2"></i>
                    Chek El
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item"><a class="nav-link" href="/welcome">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="/ask-ai">Ask AI</a></li>
                        <li class="nav-item"><a class="nav-link" href="/quiz">Quiz</a></li>
                        <li class="nav-item"><a class="nav-link" href="/community">Community</a></li>
                        <li class="nav-item"><a class="nav-link" href="/feedback">Feedback</a></li>
                        <li class="nav-item"><a class="nav-link" href="/learning-planner">Learning Planner</a></li>
                        <li class="nav-item"><a class="nav-link" href="/notes">Notes</a></li>
                        <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="login-container">
            <div class="login-card-wrapper">
                <div class="login-card">
                    <div class="brand-section">
                        <div class="logo-container">
                            <img src="/public/images/logo.jpg" alt="Chek El Logo" class="logo-img">
                        </div>
                        <h1 class="brand-name">Chek El</h1>
                        <p class="welcome-text">Your ultimate platform for personalized learning and growth!</p>
                    </div>
                    
                    <div class="form-section">
                        <div class="tab-container">
                            <div class="tab active" onclick="showForm('login')">Login</div>
                            <div class="tab" onclick="showForm('register')">Sign Up</div>
                            <div class="tab-indicator"></div>
                        </div>
                        
                        <!-- Login Form -->
                        <div id="login-form" class="form-content active">
                            <div class="form-header">
                                <h3>Welcome Back</h3>
                                <p>Enter your credentials to continue</p>
                            </div>
                            <div class="form-body">
                                <div class="input-group">
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <input id="login-username" class="form-control" placeholder="Username" required>
                                </div>
                                <div class="input-group">
                                    <div class="input-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <input id="login-password" type="password" class="form-control" placeholder="Password" required>
                                    <div class="password-toggle" onclick="togglePassword('login-password')">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                </div>
                                <div class="remember-forgot">
                                    <div class="remember-me">
                                        <input type="checkbox" id="remember" class="custom-checkbox">
                                        <label for="remember">Remember me</label>
                                    </div>
                                    <a href="#" class="forgot-password">Forgot Password?</a>
                                </div>
                                <button onclick="login()" class="btn btn-primary login-btn">
                                    <span>Login</span>
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                                <p id="login-error" class="error"></p>
                                <div class="social-login">
                                    <p>Or login with</p>
                                    <div class="social-icons">
                                        <a href="#" class="social-icon google">
                                            <i class="fab fa-google"></i>
                                        </a>
                                        <a href="#" class="social-icon facebook">
                                            <i class="fab fa-facebook-f"></i>
                                        </a>
                                        <a href="#" class="social-icon twitter">
                                            <i class="fab fa-twitter"></i>
                                        </a>
                                    </div>
                                </div>
                                <p class="switch-form-text">
                                    Don't have an account? <a href="#" onclick="showForm('register')">Sign Up</a>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Sign-Up Form -->
                        <div id="register-form" class="form-content">
                            <div class="form-header">
                                <h3>Create Account</h3>
                                <p>Join our learning community today</p>
                            </div>
                            <div class="form-body">
                                <div class="input-group">
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <input id="register-username" class="form-control" placeholder="Username" required>
                                </div>
                                <div class="input-group">
                                    <div class="input-icon">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <input id="register-email" class="form-control" placeholder="Email" type="email" required>
                                </div>
                                <div class="input-group">
                                    <div class="input-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <input id="register-password" type="password" class="form-control" placeholder="Password" required>
                                    <div class="password-toggle" onclick="togglePassword('register-password')">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                </div>
                                <div class="terms-container">
                                    <input type="checkbox" id="terms" class="custom-checkbox">
                                    <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
                                </div>
                                <button onclick="register()" class="btn btn-primary login-btn">
                                    <span>Sign Up</span>
                                    <i class="fas fa-user-plus"></i>
                                </button>
                                <p id="register-error" class="error"></p>
                                <div class="social-login">
                                    <p>Or sign up with</p>
                                    <div class="social-icons">
                                        <a href="#" class="social-icon google">
                                            <i class="fab fa-google"></i>
                                        </a>
                                        <a href="#" class="social-icon facebook">
                                            <i class="fab fa-facebook-f"></i>
                                        </a>
                                        <a href="#" class="social-icon twitter">
                                            <i class="fab fa-twitter"></i>
                                        </a>
                                    </div>
                                </div>
                                <p class="switch-form-text">
                                    Already have an account? <a href="#" onclick="showForm('login')">Login</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>© 2025 Chek El. All rights reserved.</p>
        </footer>
    </div>

    <div class="background-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
    </div>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script>
        let isCheckingAuth = false;

        function showForm(formType) {
            // Remove active class from all tabs and forms
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.form-content').forEach(form => form.classList.remove('active'));
            
            // Add active class to selected tab and form
            document.getElementById(formType + '-form').classList.add('active');
            document.querySelector(`.tab[onclick="showForm('${formType}')"]`).classList.add('active');
            
            // Move tab indicator
            const activeTab = document.querySelector('.tab.active');
            const tabIndicator = document.querySelector('.tab-indicator');
            tabIndicator.style.left = activeTab.offsetLeft + 'px';
            tabIndicator.style.width = activeTab.offsetWidth + 'px';
        }

        function togglePassword(inputId) {
            const passwordInput = document.getElementById(inputId);
            const icon = passwordInput.nextElementSibling.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        async function checkAuth() {
            if (isCheckingAuth || window.location.pathname !== '/login') return;
            isCheckingAuth = true;
            try {
                const response = await fetch('/api/check-auth');
                const data = await response.json();
                if (data.authenticated) {
                    window.location.href = '/welcome';
                }
            } catch (error) {
                console.error('Error checking auth:', error);
            } finally {
                isCheckingAuth = false;
            }
        }

        async function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            
            if (!username || !password) {
                showError(errorDiv, 'Please enter both username and password');
                return;
            }
            
            try {
                errorDiv.innerText = '';
                const loginBtn = document.querySelector('#login-form .login-btn');
                loginBtn.disabled = true;
                loginBtn.innerHTML = '<span>Logging in...</span><div class="spinner"></div>';
                
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    loginBtn.innerHTML = '<span>Success!</span><i class="fas fa-check"></i>';
                    setTimeout(() => {
                        window.location.href = '/welcome';
                    }, 1000);
                } else {
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right"></i>';
                    showError(errorDiv, data.error || 'Login failed');
                }
            } catch (error) {
                const loginBtn = document.querySelector('#login-form .login-btn');
                loginBtn.disabled = false;
                loginBtn.innerHTML = '<span>Login</span><i class="fas fa-arrow-right"></i>';
                showError(errorDiv, 'An error occurred. Please try again.');
                console.error('Error in login:', error);
            }
        }

        async function register() {
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const terms = document.getElementById('terms').checked;
            const errorDiv = document.getElementById('register-error');
            
            if (!username || !email || !password) {
                showError(errorDiv, 'Please fill in all fields');
                return;
            }
            
            if (!terms) {
                showError(errorDiv, 'Please agree to the Terms of Service and Privacy Policy');
                return;
            }
            
            try {
                errorDiv.innerText = '';
                const registerBtn = document.querySelector('#register-form .login-btn');
                registerBtn.disabled = true;
                registerBtn.innerHTML = '<span>Creating account...</span><div class="spinner"></div>';
                
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                
                const data = await response.json();
                
                if (data.status === 'User registered') {
                    registerBtn.innerHTML = '<span>Success!</span><i class="fas fa-check"></i>';
                    setTimeout(() => {
                        showForm('login');
                        document.getElementById('register-username').value = '';
                        document.getElementById('register-email').value = '';
                        document.getElementById('register-password').value = '';
                        document.getElementById('terms').checked = false;
                        
                        // Reset register button
                        registerBtn.disabled = false;
                        registerBtn.innerHTML = '<span>Sign Up</span><i class="fas fa-user-plus"></i>';
                        
                        // Show success message in login form
                        const loginErrorDiv = document.getElementById('login-error');
                        loginErrorDiv.innerText = 'Registration successful! Please log in.';
                        loginErrorDiv.style.display = 'block';
                        loginErrorDiv.classList.add('success');
                        setTimeout(() => { 
                            loginErrorDiv.style.display = 'none';
                            loginErrorDiv.classList.remove('success');
                        }, 5000);
                    }, 1000);
                } else {
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '<span>Sign Up</span><i class="fas fa-user-plus"></i>';
                    showError(errorDiv, data.error || 'Registration failed');
                }
            } catch (error) {
                const registerBtn = document.querySelector('#register-form .login-btn');
                registerBtn.disabled = false;
                registerBtn.innerHTML = '<span>Sign Up</span><i class="fas fa-user-plus"></i>';
                showError(errorDiv, 'An error occurred. Please try again.');
                console.error('Error in register:', error);
            }
        }

        function showError(element, message) {
            element.innerText = message;
            element.style.display = 'block';
            element.classList.add('shake');
            setTimeout(() => { 
                element.classList.remove('shake');
            }, 500);
            setTimeout(() => { 
                element.style.display = 'none';
            }, 5000);
        }

        // Initialize tab indicator position
        window.addEventListener('load', function() {
            const activeTab = document.querySelector('.tab.active');
            const tabIndicator = document.querySelector('.tab-indicator');
            tabIndicator.style.left = activeTab.offsetLeft + 'px';
            tabIndicator.style.width = activeTab.offsetWidth + 'px';
            
            // Check authentication
            checkAuth();
            
            // Add animation classes to elements
            document.querySelector('.login-card').classList.add('fade-in');
            
            // Animate background shapes
            document.querySelectorAll('.shape').forEach((shape, index) => {
                setTimeout(() => {
                    shape.classList.add('active');
                }, index * 200);
            });
        });
    </script>
</body>
</html>